toasts=window.toasts={},function(t,e,n){var i=function(t,e){var n=new r.model.Toast(t||{},e||{}),i={id:n.cid,model:n,get:function(t){return n.get(t)},set:function(t,e,o){return n.set(t,e,o),i},reset:function(t){return n.set(n.defaults),i},remove:function(t){return n.destroy(t),i},toJSON:function(t){return n.toJSON()}};return i},o=function(t,i){var o=new n.Collection,s=new r.controller.Queue([],{collection:o});new r.view.Queue({el:t,controller:s});return t={all:function(){return o.models},add:function(t,e){return o.add(t.model,e),t},get:function(t){return o.get(t)},first:function(){return o.first()},last:function(){return o.last()},find:function(t){return e.contains(["error","warning","info","success"],t)?[]:o.filter(function(e){return t===e.get("type")},this)},remove:function(n){var i=this.get(n);return e.isUndefined(i)||i.remove(),t},reset:function(e){return o.each(function(t){t.remove(e)},this),t}}},r=window.toasts={toasts:{},model:{},controller:{},view:{},all:function(){return this.toasts.all()},create:function(t,e){var n=new i(t||{},e||{});return this.toasts.add(n)},cook:function(t,n){return this.create(e.extend({type:"info",icon:"editor-help",content:t},n||{}))},bake:function(t,n){return this.create(e.extend({type:"success",icon:"info",content:t},n||{}))},fry:function(t,n){return this.create(e.extend({type:"warning",icon:"warning",content:t},n||{}))},burn:function(t,n){return this.create(e.extend({type:"error",icon:"warning",content:t},n||{}))},success:function(t,e){return this.bake(t,e)},info:function(t,e){return this.cook(t,e)},warn:function(t,e){return this.fry(t,e)},error:function(t,e){return this.burn(t,e)},get:function(t){return this.toasts.get(t)},find:function(t){return this.toasts.find(t)},remove:function(t){return this.toasts.remove(t)},reset:function(){return this.toasts.reset()}};r.model.Toast=n.Model.extend({defaults:{type:"info",icon:"info",time:new Date,content:"",destroy:5,callback:!1}}),r.controller.Queue=n.Model.extend({initialize:function(t,e){var e=e||{};this.collection=e.collection}}),r.view.Toast=wp.Backbone.View.extend({className:"toast inverted",template:wp.template("wpmoly-toast"),events:{'click [data-action="dismiss"]':"dismiss",'click [data-action="cancel"]':"cancel"},initialize:function(t){var t=t||{};this.controller=t.controller,this.model=t.model},prepare:function(){return{icon:this.model.get("icon"),time:this.model.get("time"),content:this.model.get("content"),callback:this.model.get("callback")}},render:function(){wp.Backbone.View.prototype.render.apply(this,arguments),this.$el.prop("id",this.model.cid.replace("c","toast-"));var t=this.model,n=t.get("type"),i={error:"fail",warning:"warn",info:"info",success:"success"};e.has(i,n)&&this.$el.addClass(i[n]);var o=t.get("destroy")||0;return o&&e.delay(e.bind(t.destroy,t),1e3*o),this},dismiss:function(){return this.model.destroy(),this},cancel:function(){var t=this.model.get("callback");return e.isFunction(t)&&t.apply(),this.dismiss(),this},remove:function(t){return this._removeElement(t),this.stopListening(),this},_removeElement:function(t){return(t=t||{}).now?this.$el.remove():this.$el.fadeOut(500,function(){this.remove()}),this}}),r.view.Queue=wp.Backbone.View.extend({toasts:[],initialize:function(t){var t=t||{};this.controller=t.controller,this.collection=this.controller.collection,this.render(),this.bindEvents()},bindEvents:function(){return this.listenTo(this.collection,"add",this.addToast),this.listenTo(this.collection,"remove",this.removeToast),this},addToast:function(t,n,i){var o=e.find(this.toasts,function(e){return e.model.cid===t.cid});if(e.isUndefined(o))o=new r.view.Toast({controller:this.controller,model:t});else{if(!e.isArray(o))return this;o=o.shift()}return this.toasts.push(o),this.views.add(o),this},removeToast:function(t,n,i){var o=e.filter(this.toasts,function(e){return e.model.cid===t.cid});return e.isArray(o)?((o=o.shift()).remove(i),this):this}}),r.createQueue=function(){var t=document.querySelector('[data-type="toasts"]');return!!t&&new o(t)},r.run=function(){console.info("[toasts]: running!");var t=r.createQueue();return!!t&&e.omit(e.extend(r,{toasts:t}),"model","controller","view","createQueue","run")}}(jQuery,_,Backbone),jQuery(document).ready(function(t){t("#wpbody").append(t('<div class="toasts" data-type="toasts"></div>')),toasts.run()});